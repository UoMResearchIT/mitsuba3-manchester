<scene version="3.0.2">
	<default name="spp" value="640" />
	<default name="resy" value="1024" />
	<default name="resx" value="1024" />
	<default name="max_depth" value="50" />
	<integrator type="ptracer_c">
		<integer name="max_depth" value="$max_depth" />
		<boolean name="hide_emitters" value="false" />
	</integrator>
	
	<sensor type="perspective">
		<float name="fov" value="40" />

		<transform name="to_world">
            <!-- check the whole scene -->
			<lookat origin="100,-3000,800" target="0,0,1000" up="0, 0, 1"/>
			<!-- Check the detector-->
            <!-- <lookat origin="0,0,1000" target="200,0,1500" up="0, 0, 1"/> -->
            <!-- <lookat origin="-2499,0,2600" target="200,0,1500" up="0, 0, 1"/> -->
        </transform>
		<sampler type="independent">
			<integer name="sample_count" value="$spp" />
		</sampler>

		<film type="hdrfilm">
			<integer name="width" value="$resx" />
			<integer name="height" value="$resy" />
			<string name="file_format" value="openexr" />
			<string name="pixel_format" value="rgb" />
			
			<string name="component_format" value="uint32" />
			<rfilter type="tent" />
		</film>
	</sensor>

	<bsdf type="twosided" id="MirrorBSDF">
		<bsdf type="conductor">
			<string name="material" value="none" />
		</bsdf>
	</bsdf>

	<bsdf type="twosided" id="RoughMirrorBSDF">
		<bsdf type="roughconductor">
			<string name="material" value="none" />
			<spectrum name="alpha" value="0.01" />
		</bsdf>
	</bsdf>

	<bsdf type="twosided" id="test">
		<bsdf type="diffuse">
			<rgb name="reflectance" value="1, 1, 1" />
		</bsdf>
	</bsdf>

	<bsdf type="twosided" id="test2">
		<bsdf type="diffuse">
			<rgb name="reflectance" value="0.9, 0.5, 0.2" />
		</bsdf>
	</bsdf>   

    <shape type="obj">
        <string name="filename" value="mirrors.obj"/>
        <transform name="to_world">
			<lookat origin="0,0,0" target="10,0, -1" up="0, 0, 1" />
		</transform>
		<ref id="MirrorBSDF" />	
    </shape>

    <shape type="obj">
        <string name="filename" value="detector_thick.obj"/>
        <transform name="to_world">
            <rotate x ="1"  angle="90"/>
			<lookat origin="200,0,1500" target="-10,0,0" up="1, 0, 0" />
        </transform>
		<ref id="test" />	
    </shape>

    
	<!-- Constant light to debug-->
 	<emitter type='constant' id='cs1'>
        <rgb name='radiance' value='1'/>
    </emitter>

    <emitter type="spot">
        <transform name="to_world">
            <lookat origin="-10, 0, -100" target="100,0,500" up="0,1,0" />
        </transform>
        <float name="cutoff_angle" value="1"/>
        <rgb name="intensity" value="200000000.0" />
    </emitter>

    <!-- <emitter type="photon_emitter">
        <transform name="to_world">
            <lookat origin="-10, 0, -100" target="100,0,500" up="0,1,0" />
        </transform>
        <rgb name="intensity" value="200000000.0" />
    </emitter> -->

    <!-- BOX -->
    <shape type="rectangle" id="backwall">
		<transform name="to_world">
			<scale x="5000" y="5000" />
			<lookat origin="0,2500,0" target="0, -1, 0" up="0, 0, 1" />
		</transform>
        <bsdf type="diffuse">
            <rgb name="reflectance" value="1, 1, 1" />
        </bsdf>
	</shape>
    <shape type="rectangle" id="leftwall">
		<transform name="to_world">
			<scale x="5000" y="5000" />
			<lookat origin="-2500,0,0," target="0, 0, 0" up="0, 0, 1" />
		</transform>
        <bsdf type="diffuse">
            <rgb name="reflectance" value="0.32, 0.46, 0.23" />
        </bsdf>
	</shape>
    <shape type="rectangle" id="rightwall">
		<transform name="to_world">
			<scale x="5000" y="5000" />
			<lookat origin="2500,0,0," target="0, 0, 0" up="0, 0, 1" />
		</transform>
        <bsdf type="diffuse">
            <rgb name="reflectance" value="0.32, 0.46, 0.23" />
        </bsdf>
	</shape>
</scene>